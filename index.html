<!DOCTYPE html>
<html lang="kg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nookat Go - –¢–∞–º–∞–∫ –∂–µ—Ç–∫–∏—Ä“Ø“Ø</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>

    <nav class="top-nav">
        <a href="#" class="logo">NOOKAT<span>GO</span></a>
        <div class="lang-selector">
            <span id="lang-kg" class="active" onclick="window.changeLang('kg')">KG</span>
            <span id="lang-ru" onclick="window.changeLang('ru')">RU</span>
        </div>
    </nav>

    <header class="hero-search">
        <h1 id="hero-title">–ù–æ–æ–∫–∞—Ç—Ç–∞–≥—ã —ç“£ –º—ã–∫—Ç—ã –¥–∞–∞–º–¥–∞—Ä</h1>
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" oninput="window.searchFood()" placeholder="–¢–∞–º–∞–∫ –∂–µ –∫–∞—Ñ–µ –∏–∑–¥”©”©...">
        </div>
    </header>

    <div class="categories-container">
        <div class="categories">
            <button class="cat-item active" onclick="window.filterMenu('all', event)">–ë–∞–∞—Ä—ã</button>
            <button class="cat-item" onclick="window.filterMenu('national', event)">–£–ª—É—Ç—Ç—É–∫</button>
            <button class="cat-item" onclick="window.filterMenu('drinks', event)">–°—É—É–ª–∞—Ä</button>
        </div>
    </div>

    <main id="menu-grid" class="menu-grid"></main>

    <div id="cartBar" class="bottom-cart" onclick="window.showCart()" style="display:none;">
        <div><span id="cartCount">0</span> <span>–°–ï–ë–ï–¢</span></div>
        <div><span id="cartSum">0</span> —Å–æ–º</div>
    </div>

    <div id="productModal" class="modal-overlay" onclick="if(event.target == this) window.closeProduct()">
        <div class="modal-content">
            <img id="modalImg" src="">
            <div class="modal-info">
                <h2 id="modalName"></h2>
                <button id="addBtnAction" class="add-to-cart-big">–°–µ–±–µ—Ç–∫–µ –∫–æ—à—É—É</button>
            </div>
        </div>
    </div>

    <div id="cartModal" class="modal-overlay" onclick="if(event.target == this) window.closeCart()">
        <div class="modal-content" style="max-height: 90vh; overflow-y: auto;">
            <h2 style="padding:20px;">–°–µ–±–µ—Ç–∏“£–∏–∑</h2>
            <div id="cartList" style="padding: 0 20px;"></div>
            
            <div style="padding: 20px;">
                <label>–ñ–µ—Ç–∫–∏—Ä“Ø“Ø –∞–π–º–∞–≥—ã:</label>
                <select id="deliveryType" onchange="window.calculateTotal()" style="width:100%; padding:10px; margin:10px 0;">
                    <option value="0">–ù–æ–æ–∫–∞—Ç –∏—á–∏ (–ê–∫—ã—Å—ã–∑)</option>
                    <option value="150">–®–∞–∞—Ä —Å—ã—Ä—Ç—ã (+150 —Å–æ–º)</option>
                </select>

                <label>–¢”©–ª”©–º —ã–∫–º–∞—Å—ã:</label>
                <select id="paymentMethod" onchange="window.toggleMbank(this.value)" style="width:100%; padding:10px; margin:10px 0;">
                    <option value="–ù–∞–ª–∏—á–∫–∏">üíµ –ù–∞–ª–∏—á–∫–∏</option>
                    <option value="MBANK">üíé MBANK</option>
                </select>

                <div id="mbankDetails" style="display:none; background:#f0fff0; padding:10px; border:1px dashed green; text-align:center;">
                    <p>0556 61 61 74 <button onclick="window.copyNumber()">üìã</button></p>
                </div>

                <input type="text" id="userName" placeholder="–ê—Ç—ã“£—ã–∑..." style="width:100%; padding:12px; margin-top:10px;">
                <input type="text" id="userAddress" placeholder="–î–∞—Ä–µ–≥–∏“£–∏–∑..." style="width:100%; padding:12px; margin-top:10px;">
                
                <h3 style="margin-top:15px;">–ñ–∞–ª–ø—ã: <span id="finalSum">0</span> —Å–æ–º</h3>
                <button onclick="window.checkout()" style="width:100%; background:#25d366; color:white; padding:15px; border:none; border-radius:10px; font-weight:900; margin-top:10px;">–ó–ê–ö–ê–ó–î–´ –ñ”®–ù”®–¢“Æ“Æ</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCjsFILpJUY9K1gyJx-f8-9BkFu7T3-g-A",
            authDomain: "nookat-go-6fcf5.firebaseapp.com",
            projectId: "nookat-go-6fcf5",
            databaseURL: "https://nookat-go-6fcf5-default-rtdb.firebaseio.com/",
            appId: "1:423808562168:web:7cabb4d7b6415d0fcd5c0d"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const products = [
            { id: 1, cat: "national", name_kg: "–û—à –∞—à—ã (–ü–ª–æ–≤)", name_ru: "–û—à—Å–∫–∏–π –ü–ª–æ–≤", price: 250, img: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c" },
            { id: 2, cat: "national", name_kg: "–ß–æ—é–ª–º–∞ –õ–∞–≥–º–∞–Ω", name_ru: "–¢—è–Ω—É—Ç—ã–π –õ–∞–≥–º–∞–Ω", price: 220, img: "https://images.unsplash.com/photo-1512058560366-cd2427ff542c" },
            { id: 3, cat: "drinks", name_kg: "Coca-Cola 1–ª", name_ru: "Coca-Cola 1–ª", price: 85, img: "https://images.unsplash.com/photo-1622483767028-3f66f32aef97" }
        ];

        let cart = [];
        let currentLang = 'kg';

        window.changeLang = (l) => {
            currentLang = l;
            document.getElementById('lang-kg').classList.toggle('active', l === 'kg');
            document.getElementById('lang-ru').classList.toggle('active', l === 'ru');
            window.renderMenu();
        };

        window.renderMenu = (data = products) => {
            const grid = document.getElementById('menu-grid');
            grid.innerHTML = data.map(p => `
                <div class="food-card" onclick="window.openProduct(${p.id})">
                    <img src="${p.img}">
                    <h3>${currentLang === 'kg' ? p.name_kg : p.name_ru}</h3>
                    <span>${p.price} —Å–æ–º</span>
                </div>
            `).join('');
        };

        window.openProduct = (id) => {
            const p = products.find(x => x.id === id);
            document.getElementById('modalImg').src = p.img;
            document.getElementById('modalName').innerText = currentLang === 'kg' ? p.name_kg : p.name_ru;
            document.getElementById('addBtnAction').onclick = () => {
                cart.push(p);
                window.updateCartUI();
                window.closeProduct();
            };
            document.getElementById('productModal').style.display = 'flex';
        };

        window.updateCartUI = () => {
            const subtotal = cart.reduce((a, b) => a + b.price, 0);
            document.getElementById('cartCount').innerText = cart.length;
            document.getElementById('cartSum').innerText = subtotal;
            document.getElementById('cartBar').style.display = cart.length > 0 ? 'flex' : 'none';
        };

        window.showCart = () => {
            document.getElementById('cartModal').style.display = 'flex';
            const list = document.getElementById('cartList');
            list.innerHTML = cart.map((item, i) => `
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span>${item.name_kg}</span>
                    <b>${item.price}—Å <button onclick="window.removeItem(${i})" style="color:red; border:none; background:none;">‚úï</button></b>
                </div>
            `).join('');
            window.calculateTotal();
        };

        window.removeItem = (i) => {
            cart.splice(i, 1);
            window.updateCartUI();
            window.showCart();
            if(cart.length === 0) window.closeCart();
        };

        window.calculateTotal = () => {
            const sub = cart.reduce((a, b) => a + b.price, 0);
            const del = parseInt(document.getElementById('deliveryType').value);
            document.getElementById('finalSum').innerText = sub + del;
        };

        window.toggleMbank = (v) => {
            document.getElementById('mbankDetails').style.display = v === 'MBANK' ? 'block' : 'none';
        };

        window.checkout = async () => {
            const name = document.getElementById('userName').value.trim();
            const addr = document.getElementById('userAddress').value.trim();
            const pay = document.getElementById('paymentMethod').value;
            const final = document.getElementById('finalSum').innerText;

            if(!name || !addr) return alert("–ê—Ç—ã“£—ã–∑–¥—ã –∂–∞–Ω–∞ –¥–∞—Ä–µ–≥–∏“£–∏–∑–¥–∏ –∂–∞–∑—ã“£—ã–∑!");

            const itemsText = cart.map(i => i.name_kg).join(", ");

            try {
                // Firebase'–≥–µ –∂–∞–∑—É—É
                const ordersRef = ref(database, 'orders');
                await set(push(ordersRef), {
                    customerName: name, address: addr, items: itemsText, totalPrice: final, paymentMethod: pay, time: new Date().toLocaleString()
                });

                // WhatsApp –∞—á—É—É
                const msg = `üöÄ –ó–ê–ö–ê–ó\nüë§ –ê—Ç—ã: ${name}\nüìç –î–∞—Ä–µ–∫: ${addr}\nüç¥ –¢–∞–º–∞–∫—Ç–∞—Ä: ${itemsText}\nüí∞ –°—É–º–º–∞: ${final} —Å–æ–º\nüí≥ –¢”©–ª”©–º: ${pay}`;
                window.open(`https://wa.me/996556616174?text=${encodeURIComponent(msg)}`);

                cart = [];
                window.updateCartUI();
                window.closeCart();
            } catch (e) { alert("–ö–∞—Ç–∞: " + e.message); }
        };

        window.closeProduct = () => document.getElementById('productModal').style.display = 'none';
        window.closeCart = () => document.getElementById('cartModal').style.display = 'none';
        window.copyNumber = () => { navigator.clipboard.writeText("0556616174"); alert("–ù–æ–º–µ—Ä –∫”©—á“Ø—Ä“Ø–ª–¥“Ø!"); };
        window.searchFood = () => {
            const val = document.getElementById('searchInput').value.toLowerCase();
            const filtered = products.filter(p => p.name_kg.toLowerCase().includes(val) || p.name_ru.toLowerCase().includes(val));
            window.renderMenu(filtered);
        };
        window.filterMenu = (c, e) => {
            document.querySelectorAll('.cat-item').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            window.renderMenu(c === 'all' ? products : products.filter(p => p.cat === c));
        };

        window.renderMenu();
    </script>
</body>
</html>

